<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog | Fused Frame Photography</title>
    <link rel="icon" href="https://cdn-eu.fusedframe.co.uk/main-logos/jpg/squarefavicon-nocircle.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gray-matter/4.0.3/gray-matter.min.js"></script>
    <style>
        .prose img { border-radius: 0.75rem; margin-top: 2rem; margin-bottom: 2rem; border: 1px solid #1e293b; }
        .prose a { color: #94fdf8; text-decoration: none; }
        .prose a:hover { text-decoration: underline; }
        .prose h1, .prose h2, .prose h3 { color: #f8fafc; font-weight: 700; margin-top: 1.5em; }
        .prose p { margin-bottom: 1.25em; line-height: 1.75; color: #94a3b8; }
        .brand-glow { text-shadow: 0 0 20px rgba(148, 253, 248, 0.2); }
        .card-hover:hover { border-color: #94fdf8; box-shadow: 0 0 25px rgba(148, 253, 248, 0.05); }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex flex-col font-sans">

    <!-- Header -->
    <header class="border-b border-slate-900 sticky top-0 bg-slate-950/80 backdrop-blur-md z-50">
        <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
            <a href="/blog" class="flex items-center gap-3">
                <img src="https://cdn-eu.fusedframe.co.uk/main-logos/png/squarelogo-light-crop.png" alt="FFP" class="h-10 w-auto">
                <span class="font-bold text-xl tracking-tight hidden sm:inline">BLOG</span>
            </a>
            <nav class="flex gap-6 text-sm font-medium text-slate-400">
                <a href="https://www.fusedframe.co.uk" class="hover:text-white transition">Portfolio</a>
                <a href="/blog" class="text-[#94fdf8]">Posts</a>
            </nav>
        </div>
    </header>

    <main class="flex-grow max-w-5xl mx-auto px-6 py-12 w-full">
        <div id="app">
            <!-- Loading State -->
            <div id="loading" class="flex flex-col items-center justify-center py-20">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#94fdf8] mb-4"></div>
                <p class="text-slate-500">Developing frames...</p>
            </div>

            <!-- Blog List View (Default) -->
            <div id="list-view" class="hidden">
                <div class="mb-12">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 brand-glow">Field Notes</h1>
                    <p class="text-slate-400 text-lg">Behind the lens, technical guides, and project updates.</p>
                </div>

                <div id="category-filter" class="flex flex-wrap gap-2 mb-8">
                    <!-- Categories injected here -->
                </div>

                <div id="posts-grid" class="grid gap-8 sm:grid-cols-2">
                    <!-- Posts injected here -->
                </div>
            </div>

            <!-- Single Post View -->
            <div id="post-view" class="hidden">
                <button onclick="router.navigate('/')" class="mb-8 text-sm text-slate-500 hover:text-[#94fdf8] flex items-center gap-2 transition">
                    ← Back to all posts
                </button>
                <article>
                    <div id="post-header" class="mb-10">
                        <div id="post-meta" class="flex gap-3 text-sm text-[#94fdf8] font-mono mb-4"></div>
                        <h1 id="post-title" class="text-4xl md:text-6xl font-bold mb-6"></h1>
                        <div id="post-author" class="flex items-center gap-3 border-t border-slate-900 pt-6">
                            <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-xs font-bold text-slate-400">AD</div>
                            <div>
                                <p class="text-sm font-semibold text-slate-200" id="author-name"></p>
                                <p class="text-xs text-slate-500" id="post-date"></p>
                            </div>
                        </div>
                    </div>
                    <div id="post-content" class="prose max-w-none"></div>
                </article>
            </div>
        </div>
    </main>

    <footer class="mt-20 py-10 border-t border-slate-900 text-center text-sm text-slate-500">
        <p>© Adlai Dyson | Fused Frame Photography</p>
        <p class="mt-2">Powered by Cloudflare & Markdown</p>
    </footer>

    <script>
        // Configuration: List your markdown filenames here
        // In a real automated setup, you could use a GitHub action to generate this list.
        const postFiles = [
            'welcome-to-fused-frame.md',
            'photography-gear-2024.md'
        ];

        const state = {
            posts: [],
            currentFilter: 'All'
        };

        const router = {
            navigate: (path) => {
                const url = new URL(window.location);
                if (path === '/') url.searchParams.delete('post');
                else url.searchParams.set('post', path);
                window.history.pushState({}, '', url);
                handleRoute();
            }
        };

        async function init() {
            try {
                const loadedPosts = await Promise.all(postFiles.map(fetchPost));
                state.posts = loadedPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
                handleRoute();
            } catch (err) {
                console.error("Error loading posts:", err);
                document.getElementById('loading').innerHTML = `<p class="text-red-400">Failed to load posts. Check console.</p>`;
            }
        }

        async function fetchPost(filename) {
            const response = await fetch(`/blog/posts/${filename}`);
            const text = await response.text();
            
            // Basic Front-matter parser since gray-matter is huge
            const fmMatch = text.match(/^---([\s\S]*?)---/);
            const content = text.replace(/^---[\s\S]*?---/, '');
            const metadata = {};
            
            if (fmMatch) {
                fmMatch[1].split('\n').forEach(line => {
                    const [key, ...val] = line.split(':');
                    if (key && val) metadata[key.trim()] = val.join(':').trim();
                });
            }

            return {
                id: filename.replace('.md', ''),
                title: metadata.title || 'Untitled',
                date: metadata.date || 'Unknown Date',
                author: metadata.author || 'Adlai Dyson',
                category: metadata.category || 'General',
                excerpt: metadata.excerpt || content.substring(0, 150).replace(/[#*`]/g, '') + '...',
                content: content
            };
        }

        function handleRoute() {
            const params = new URLSearchParams(window.location.search);
            const postId = params.get('post');
            
            document.getElementById('loading').classList.add('hidden');
            
            if (postId) {
                showPost(postId);
            } else {
                showList();
            }
            window.scrollTo(0,0);
        }

        function showList() {
            document.getElementById('post-view').classList.add('hidden');
            const listView = document.getElementById('list-view');
            listView.classList.remove('hidden');

            const grid = document.getElementById('posts-grid');
            const filterContainer = document.getElementById('category-filter');
            
            const categories = ['All', ...new Set(state.posts.map(p => p.category))];
            filterContainer.innerHTML = categories.map(cat => `
                <button onclick="setFilter('${cat}')" class="px-4 py-1.5 rounded-full text-xs font-medium border ${state.currentFilter === cat ? 'bg-[#94fdf8] text-slate-950 border-[#94fdf8]' : 'border-slate-800 text-slate-400 hover:border-slate-600'} transition">
                    ${cat}
                </button>
            `).join('');

            const filtered = state.currentFilter === 'All' ? state.posts : state.posts.filter(p => p.category === state.currentFilter);

            grid.innerHTML = filtered.map(post => `
                <article onclick="router.navigate('${post.id}')" class="group cursor-pointer bg-slate-900 border border-slate-800 rounded-2xl p-6 transition-all duration-300 card-hover">
                    <div class="flex gap-2 text-[10px] font-bold tracking-widest text-[#94fdf8] uppercase mb-4">
                        <span>${post.category}</span>
                        <span class="text-slate-700">•</span>
                        <span class="text-slate-500">${post.date}</span>
                    </div>
                    <h2 class="text-2xl font-bold mb-3 group-hover:text-[#94fdf8] transition">${post.title}</h2>
                    <p class="text-slate-400 text-sm leading-relaxed mb-6">${post.excerpt}</p>
                    <div class="text-sm font-semibold text-slate-300 flex items-center gap-2">
                        Read Entry <span class="group-hover:translate-x-1 transition-transform">→</span>
                    </div>
                </article>
            `).join('');
        }

        function setFilter(cat) {
            state.currentFilter = cat;
            showList();
        }

        function showPost(id) {
            const post = state.posts.find(p => p.id === id);
            if (!post) {
                router.navigate('/');
                return;
            }

            document.getElementById('list-view').classList.add('hidden');
            document.getElementById('post-view').classList.remove('hidden');

            document.getElementById('post-title').innerText = post.title;
            document.getElementById('post-meta').innerHTML = `<span>${post.category}</span> <span>/</span> <span>${post.date}</span>`;
            document.getElementById('author-name').innerText = post.author;
            document.getElementById('post-date').innerText = `Posted on ${post.date}`;
            document.getElementById('post-content').innerHTML = marked.parse(post.content);
        }

        window.addEventListener('popstate', handleRoute);
        init();
    </script>
</body>
</html>