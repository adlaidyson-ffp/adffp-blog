<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="meta-title">Blog | Adlai Dyson | Fused Frame Photography</title>
    <meta name="description" id="meta-desc" content="Hey, I'm Adlai, an events and portraiture photographer from Rotherham. Join me here and read my posst to learn about photography, skills, and my journey!">
    <link rel="icon" href="https://cdn-eu.fusedframe.co.uk/main-logos/jpg/squarefavicon-nocircle.jpg">
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script defer src="https://analytics.adffp.uk/script.js" data-website-id="c490b3f9-34ee-485d-b09a-5f869f545a12"></script>
    
    <style>
        .prose img { border-radius: 0.75rem; margin-top: 2rem; margin-bottom: 2rem; border: 1px solid #1e293b; }
        .prose a { color: #94fdf8; text-decoration: none; }
        .prose a:hover { text-decoration: underline; }
        .prose h1, .prose h2, .prose h3 { color: #f8fafc; font-weight: 700; margin-top: 1.5em; }
        .prose p { margin-bottom: 1.25em; line-height: 1.75; color: #94a3b8; }
        .brand-glow { text-shadow: 0 0 20px rgba(148, 253, 248, 0.2); }
        .card-hover:hover { border-color: #94fdf8; box-shadow: 0 0 25px rgba(148, 253, 248, 0.05); }
        input:focus { outline: none; border-color: #94fdf8 !important; box-shadow: 0 0 10px rgba(148, 253, 248, 0.1); }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex flex-col font-sans">

    <!-- Header -->
    <header class="border-b border-slate-900 sticky top-0 bg-slate-950/80 backdrop-blur-md z-50">
        <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
            <a href="/" class="flex items-center gap-3">
                <img src="https://cdn-eu.fusedframe.co.uk/main-logos/png/squarelogo-light-crop.png" alt="FFP" class="h-10 w-auto">
                <span class="font-bold text-xl tracking-tight hidden sm:inline">BLOG</span>
            </a>
            <nav class="flex gap-6 text-sm font-medium text-slate-400">
                <a href="https://www.fusedframe.co.uk" class="hover:text-white transition">Main Site</a>
                <a href="/" class="text-[#94fdf8]">Post Feed</a>
            </nav>
        </div>
    </header>

    <main class="flex-grow max-w-5xl mx-auto px-6 py-12 w-full">
        <div id="app">
            <!-- Loading State -->
            <div id="loading" class="flex flex-col items-center justify-center py-20">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#94fdf8] mb-4"></div>
                <p class="text-slate-500">Developing frames...</p>
            </div>

            <!-- Blog List View -->
            <div id="list-view" class="hidden">
                <div class="mb-12">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 brand-glow">Posts</h1>
                    <p class="text-slate-400 text-lg mb-8">Select a post below to read it.</p>
                    
                    <!-- Search and Sort Controls -->
                    <div class="flex flex-col md:flex-row gap-4 items-start md:items-center justify-between bg-slate-900/50 p-4 rounded-xl border border-slate-800">
                        <div class="relative w-full md:max-w-md">
                            <input type="text" id="search-input" placeholder="Search titles or excerpts..." 
                                class="w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 text-sm text-slate-200 focus:ring-1 focus:ring-[#94fdf8]">
                            <span class="absolute right-3 top-2.5 text-slate-600 italic text-xs pointer-events-none">Search</span>
                        </div>
                        <div class="flex items-center gap-3 w-full md:w-auto">
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Sort:</label>
                            <select id="sort-select" class="bg-slate-950 border border-slate-800 rounded-lg px-3 py-2 text-sm text-slate-300 focus:ring-1 focus:ring-[#94fdf8] cursor-pointer">
                                <option value="newest">Newest First</option>
                                <option value="oldest">Oldest First</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="category-filter" class="flex flex-wrap gap-2 mb-8">
                    <!-- Categories injected here -->
                </div>

                <div id="posts-grid" class="grid gap-8 sm:grid-cols-2">
                    <!-- Posts injected here -->
                </div>
            </div>

            <!-- Single Post View -->
            <div id="post-view" class="hidden">
                <button onclick="router.navigate('/')" class="mb-8 text-sm text-slate-500 hover:text-[#94fdf8] flex items-center gap-2 transition">
                    ← Back to feed
                </button>
                <article>
                    <div id="post-header" class="mb-10">
                        <div id="post-meta" class="flex flex-wrap gap-3 text-sm text-[#94fdf8] font-mono mb-4"></div>
                        <h1 id="post-title" class="text-4xl md:text-6xl font-bold mb-6"></h1>
                        <div id="post-author" class="flex items-center gap-3 border-t border-slate-900 pt-6">
                            <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-xs font-bold text-slate-400 uppercase">AD</div>
                            <div>
                                <p class="text-sm font-semibold text-slate-200" id="author-name"></p>
                                <p class="text-xs text-slate-500" id="post-date"></p>
                            </div>
                        </div>
                    </div>
                    <div id="post-content" class="prose max-w-none"></div>
                </article>
            </div>
        </div>
    </main>

    <footer class="mt-20 py-10 border-t border-slate-900 text-center text-sm text-slate-500">
        <p class="font-medium text-slate-400 mb-1">© Adlai Dyson | Fused Frame Photography. All rights reserved.</p>
        <p class="text-xs">View more info at <a href="https://adffp.uk/copyright" class="text-slate-500 hover:text-[#94fdf8] underline underline-offset-4">adffp.uk/copyright</a></p>
        <p class="mt-4 text-[10px] opacity-30">Running on blog.fusedframe.co.uk</p>
    </footer>

    <script>
        /** * POST REGISTRY
         * List your .md filenames here (without the .md extension).
         */
        const postIds = [
            '2026/introducing-blog',
            '2026/making-exif-overlay'
        ];

        const state = {
            posts: [],
            currentFilter: 'All',
            searchQuery: '',
            sortBy: 'newest'
        };

        const router = {
            navigate: (path) => {
                const url = new URL(window.location);
                if (path === '/') url.searchParams.delete('p');
                else url.searchParams.set('p', path);
                window.history.pushState({}, '', url);
                handleRoute();
            }
        };

        async function init() {
            try {
                const loadedPosts = await Promise.all(postIds.map(fetchPost));
                // Filter out any posts that failed to parse meaningful data
                state.posts = loadedPosts.filter(p => p.title !== 'Untitled Post');
                
                // Initialize Listeners
                document.getElementById('search-input').addEventListener('input', (e) => {
                    state.searchQuery = e.target.value.toLowerCase();
                    renderList();
                });
                document.getElementById('sort-select').addEventListener('change', (e) => {
                    state.sortBy = e.target.value;
                    renderList();
                });

                handleRoute();
            } catch (err) {
                console.error("Error loading blog posts:", err);
                document.getElementById('loading').innerHTML = `<p class="text-red-400">Error loading post database. Ensure /posts/ directory is accessible.</p>`;
            }
        }

        async function fetchPost(id) {
            try {
                const response = await fetch(`/posts/${id}.md`);
                if (!response.ok) return { id, title: 'Untitled Post' };
                const text = await response.text();
                
                const lines = text.split('\n');
                const meta = {};
                const contentLines = [];
                
                lines.forEach(line => {
                    const trimmed = line.trim();
                    const metaMatch = trimmed.match(/^##\s*([^:]+):\s*(.*)$/);
                    
                    if (metaMatch) {
                        const key = metaMatch[1].trim().toLowerCase();
                        const value = metaMatch[2].trim();
                        meta[key] = value;
                    } else {
                        // Avoid pushing empty header lines that were just markers
                        if (trimmed !== '##') contentLines.push(line);
                    }
                });

                const content = contentLines.join('\n').trim();

                // Logic for precise sorting using date AND time
                const dateTimeStr = meta.date ? (meta.time ? `${meta.date} ${meta.time}` : `${meta.date} 00:00`) : '1970-01-01 00:00';
                const sortTimestamp = new Date(dateTimeStr).getTime();

                // Support multiple categories separated by commas
                const rawCategories = meta.category || 'Uncategorized';
                const categories = rawCategories.split(',').map(c => c.trim()).filter(c => c.length > 0);

                return {
                    id: id,
                    title: meta.title || 'Untitled Post',
                    date: meta.date || 'Recent',
                    time: meta.time || '',
                    sortTimestamp: isNaN(sortTimestamp) ? 0 : sortTimestamp,
                    author: meta.author || 'Adlai Dyson',
                    categories: categories,
                    excerpt: meta.excerpt || content.substring(0, 160).replace(/[#*`]/g, '') + '...',
                    content: content
                };
            } catch (e) {
                return { id, title: 'Untitled Post' };
            }
        }

        function handleRoute() {
            const params = new URLSearchParams(window.location.search);
            const postId = params.get('p');
            
            document.getElementById('loading').classList.add('hidden');
            
            if (postId) {
                showPost(postId);
            } else {
                showList();
            }
            window.scrollTo(0, 0);
        }

        function showList() {
            // Update Meta for SEO
            document.getElementById('meta-title').innerText = "Blog | Fused Frame Photography";
            document.getElementById('meta-desc').content = "Behind the lens, technical guides, and project updates from Adlai Dyson.";

            document.getElementById('post-view').classList.add('hidden');
            document.getElementById('list-view').classList.remove('hidden');
            renderList();
        }

        function renderList() {
            const grid = document.getElementById('posts-grid');
            const filterContainer = document.getElementById('category-filter');
            
            // Extract all unique categories across all posts
            const allCats = state.posts.flatMap(p => p.categories);
            const categories = ['All', ...new Set(allCats)];
            
            filterContainer.innerHTML = categories.map(cat => `
                <button onclick="setFilter('${cat}')" class="px-4 py-1.5 rounded-full text-xs font-medium border ${state.currentFilter === cat ? 'bg-[#94fdf8] text-slate-950 border-[#94fdf8]' : 'border-slate-800 text-slate-400 hover:border-slate-600'} transition">
                    ${cat}
                </button>
            `).join('');

            // Filtering: Post matches if "All" is selected OR if its categories array contains the filter
            let filtered = state.posts.filter(p => {
                const matchesCat = state.currentFilter === 'All' || p.categories.includes(state.currentFilter);
                const matchesSearch = p.title.toLowerCase().includes(state.searchQuery) || 
                                     p.excerpt.toLowerCase().includes(state.searchQuery);
                return matchesCat && matchesSearch;
            });

            // Advanced Sorting
            filtered.sort((a, b) => {
                return state.sortBy === 'newest' ? b.sortTimestamp - a.sortTimestamp : a.sortTimestamp - b.sortTimestamp;
            });

            if (filtered.length === 0) {
                grid.innerHTML = `<p class="col-span-full py-10 text-slate-500 italic text-center">No posts found matching your criteria.</p>`;
                return;
            }

            grid.innerHTML = filtered.map(post => `
                <article onclick="router.navigate('${post.id}')" class="group cursor-pointer bg-slate-900 border border-slate-800 rounded-2xl p-6 transition-all duration-300 card-hover">
                    <div class="flex flex-wrap gap-2 text-[10px] font-bold tracking-widest uppercase mb-4">
                        <span class="text-[#94fdf8]">${post.categories.join(' / ')}</span>
                        <span class="text-slate-700">•</span>
                        <span class="text-slate-500">${post.date}</span>
                    </div>
                    <h2 class="text-2xl font-bold mb-3 group-hover:text-[#94fdf8] transition">${post.title}</h2>
                    <p class="text-slate-400 text-sm leading-relaxed mb-6 line-clamp-3">${post.excerpt}</p>
                    <div class="text-sm font-semibold text-slate-300 flex items-center gap-2">
                        View Post <span class="group-hover:translate-x-1 transition-transform">→</span>
                    </div>
                </article>
            `).join('');
        }

        function setFilter(cat) {
            state.currentFilter = cat;
            renderList();
        }

        function showPost(id) {
            const post = state.posts.find(p => p.id === id);
            if (!post) {
                router.navigate('/');
                return;
            }

            // Update Meta for SEO
            document.getElementById('meta-title').innerText = `${post.title} | Fused Frame Blog`;
            document.getElementById('meta-desc').content = post.excerpt;

            document.getElementById('list-view').classList.add('hidden');
            document.getElementById('post-view').classList.remove('hidden');

            document.getElementById('post-title').innerText = post.title;
            
            // Render multiple categories in the header
            const catHtml = post.categories.map(cat => `<span>${cat}</span>`).join(' <span class="text-slate-700">/</span> ');
            document.getElementById('post-meta').innerHTML = `${catHtml} <span class="text-slate-700">/</span> <span>${post.date}</span>`;
            
            document.getElementById('author-name').innerText = post.author;
            document.getElementById('post-date').innerText = `Published ${post.date}`;
            document.getElementById('post-content').innerHTML = marked.parse(post.content);
        }

        window.addEventListener('popstate', handleRoute);
        init();
    </script>
</body>
</html>